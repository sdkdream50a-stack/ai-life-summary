<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- SEO Meta Tags -->
  <title>AI ÏÜåÏö∏ ÌÉÄÏûÖ ÏúÑÏ†Ø - Î∏îÎ°úÍ∑∏/SNS ÌîÑÎ°úÌïÑÏóê Ï∂îÍ∞ÄÌïòÍ∏∞ | AI Test Lab</title>
  <meta name="description" content="ÎãπÏã†Ïùò AI ÏÜåÏö∏ ÌÉÄÏûÖÏùÑ Î∏îÎ°úÍ∑∏ÎÇò SNS ÌîÑÎ°úÌïÑÏóê ÌëúÏãúÌïòÏÑ∏Ïöî! Ïπ¥Îìú, Î∞∞ÏßÄ, ÎØ∏Îãà Ïä§ÌÉÄÏùº Ï§ë ÏÑ†ÌÉùÌïòÏó¨ ÏûÑÎ≤†Îìú ÏΩîÎìúÎ•º ÏÉùÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§.">
  <link rel="canonical" href="https://smartaitest.com/widget/">

  <!-- Open Graph -->
  <meta property="og:title" content="AI ÏÜåÏö∏ ÌÉÄÏûÖ ÏúÑÏ†Ø - ÌîÑÎ°úÌïÑÏóê Ï∂îÍ∞ÄÌïòÍ∏∞">
  <meta property="og:description" content="ÎãπÏã†Ïùò ÏÜåÏö∏ ÌÉÄÏûÖÏùÑ Î∏îÎ°úÍ∑∏ÎÇò SNSÏóê ÌëúÏãúÌïòÏÑ∏Ïöî!">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://smartaitest.com/widget/">
  <meta property="og:locale" content="ko_KR">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Pretendard Font -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard@latest/dist/web/variable/pretendardvariable-dynamic-subset.min.css">

  <!-- Styles -->
  <link rel="stylesheet" href="../css/widget.css">

  <style>
    body {
      font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
    }

    /* Override container for compact layout - 20% enlarged */
    .generator-container {
      min-height: 100vh;
      background: linear-gradient(180deg, #f8fafc 0%, #e0e7ff 50%, #fce7f3 100%);
      padding-bottom: 1.2rem;
    }

    .generator-content {
      padding: 1rem;
      max-width: 1000px;
      margin: 0 auto;
    }

    .generator-section {
      margin-bottom: 1rem;
    }

    .generator-section-title {
      font-size: 1rem;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 0.6rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Style selector - 20% enlarged */
    .style-selector {
      display: flex;
      gap: 0.6rem;
    }

    .style-option {
      flex: 1;
      padding: 0.6rem;
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(99, 102, 241, 0.1);
      border-radius: 0.9rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .style-option:hover {
      border-color: rgba(99, 102, 241, 0.3);
    }

    .style-option.active {
      border-color: #6366f1;
      background: rgba(99, 102, 241, 0.1);
    }

    .style-option-icon {
      font-size: 1.5rem;
      margin-bottom: 0.3rem;
    }

    .style-option-name {
      font-size: 0.85rem;
      font-weight: 600;
      color: #1e293b;
    }

    .style-option-size {
      font-size: 0.75rem;
      color: #64748b;
    }

    /* Type selector - 20% enlarged */
    .type-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .type-option {
      padding: 0.5rem 0.75rem;
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(99, 102, 241, 0.1);
      border-radius: 0.6rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .type-option:hover {
      border-color: rgba(99, 102, 241, 0.3);
    }

    .type-option.active {
      border-color: #6366f1;
      background: rgba(99, 102, 241, 0.1);
    }

    .type-option-emoji {
      font-size: 1.2rem;
    }

    .type-option-name {
      font-size: 0.8rem;
      color: #1e293b;
      font-weight: 500;
    }

    /* Preview area - 20% enlarged */
    .preview-area {
      background: rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(15px);
      border-radius: 1.2rem;
      padding: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 220px;
      border: 1px solid rgba(99, 102, 241, 0.1);
    }

    /* Action buttons - 20% enlarged */
    .action-buttons {
      display: flex;
      gap: 0.6rem;
      margin-top: 1rem;
    }

    .action-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.9rem;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: #fff;
      border: none;
      border-radius: 0.9rem;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);
    }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(99, 102, 241, 0.35);
    }

    .action-btn.secondary {
      background: rgba(255, 255, 255, 0.8);
      color: #6366f1;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .action-btn.secondary:hover {
      background: rgba(255, 255, 255, 0.95);
    }

    .action-btn.success {
      background: linear-gradient(135deg, #22c55e, #10b981);
    }

    /* Code modal - 20% enlarged */
    .code-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 1.2rem;
    }

    .code-modal.show {
      display: flex;
    }

    .code-modal-content {
      background: #fff;
      border-radius: 1.2rem;
      padding: 1.5rem;
      max-width: 550px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .code-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.2rem;
    }

    .code-modal-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: #1e293b;
    }

    .code-modal-close {
      width: 38px;
      height: 38px;
      border: none;
      background: rgba(99, 102, 241, 0.1);
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: #64748b;
    }

    .code-modal pre {
      background: #f1f5f9;
      border-radius: 0.9rem;
      padding: 1.2rem;
      font-family: 'SF Mono', Monaco, Consolas, monospace;
      font-size: 0.85rem;
      color: #6366f1;
      line-height: 1.5;
      white-space: pre-wrap;
      word-break: break-all;
      margin-bottom: 1.2rem;
    }

    /* Two column layout for desktop - 20% enlarged */
    @media (min-width: 640px) {
      .main-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.2rem;
      }

      .left-column {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .right-column {
        display: flex;
        flex-direction: column;
      }

      .preview-area {
        flex: 1;
        min-height: 260px;
      }
    }

    /* Mobile compact */
    @media (max-width: 639px) {
      .type-option-name {
        display: none;
      }

      .type-option {
        padding: 0.6rem;
      }

      .type-option-emoji {
        font-size: 1.5rem;
      }

      .action-buttons {
        flex-wrap: wrap;
      }

      .action-btn {
        min-width: calc(50% - 0.3rem);
      }
    }
  </style>
</head>
<body class="generator-container">
  <!-- Header -->
  <header class="generator-header">
    <a href="../" class="back-link" aria-label="Back to home">
      <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    </a>
    <h1 class="header-title" data-i18n="widgetGenerator">Widget Generator</h1>
    <div style="width: 40px;"></div>
  </header>

  <!-- Content -->
  <main class="generator-content">
    <div class="main-grid">
      <!-- Left Column: Selectors -->
      <div class="left-column">
        <!-- Style Selector -->
        <section class="generator-section">
          <h2 class="generator-section-title">
            <span>üé®</span>
            <span data-i18n="selectStyle">Style</span>
          </h2>
          <div class="style-selector">
            <button class="style-option active" data-style="card">
              <div class="style-option-icon">üÉè</div>
              <div class="style-option-name" data-i18n="cardStyle">Card</div>
              <div class="style-option-size">300√ó200</div>
            </button>
            <button class="style-option" data-style="badge">
              <div class="style-option-icon">üè∑Ô∏è</div>
              <div class="style-option-name" data-i18n="badgeStyle">Badge</div>
              <div class="style-option-size">200√ó60</div>
            </button>
            <button class="style-option" data-style="mini">
              <div class="style-option-icon">‚ú®</div>
              <div class="style-option-name" data-i18n="miniStyle">Mini</div>
              <div class="style-option-size">100√ó100</div>
            </button>
          </div>
        </section>

        <!-- Type Selector -->
        <section class="generator-section">
          <h2 class="generator-section-title">
            <span>ü¶ä</span>
            <span data-i18n="selectType">Soul Type</span>
          </h2>
          <div class="type-selector">
            <!-- Rendered by JS -->
          </div>
        </section>
      </div>

      <!-- Right Column: Preview + Actions -->
      <div class="right-column">
        <!-- Preview -->
        <section class="generator-section" style="flex: 1; display: flex; flex-direction: column;">
          <h2 class="generator-section-title">
            <span>üëÅÔ∏è</span>
            <span data-i18n="preview">Preview</span>
          </h2>
          <div class="preview-area" id="preview-area">
            <!-- Rendered by JS -->
          </div>

          <!-- Action Buttons -->
          <div class="action-buttons">
            <button class="action-btn" id="btn-copy-image" title="Copy as Image">
              <span>üìã</span>
              <span data-i18n="copyImage">Copy Image</span>
            </button>
            <button class="action-btn secondary" id="btn-download" title="Download PNG">
              <span>üì•</span>
              <span data-i18n="download">Download</span>
            </button>
            <button class="action-btn secondary" id="btn-embed" title="Get Embed Code">
              <span>üîó</span>
              <span data-i18n="embedCode">Embed</span>
            </button>
            <button class="action-btn secondary" id="btn-share" title="Share">
              <span>üì§</span>
              <span data-i18n="share">Share</span>
            </button>
          </div>
        </section>
      </div>
    </div>
  </main>

  <!-- Embed Code Modal -->
  <div class="code-modal" id="embed-modal">
    <div class="code-modal-content">
      <div class="code-modal-header">
        <h3 class="code-modal-title" data-i18n="embedCodeTitle">Embed Code</h3>
        <button class="code-modal-close" id="close-modal">&times;</button>
      </div>
      <pre><code id="embed-code"></code></pre>
      <button class="action-btn" id="btn-copy-code" style="width: 100%;">
        <span>üìã</span>
        <span data-i18n="copyCode">Copy Code</span>
      </button>
    </div>
  </div>

  <!-- Scripts -->
  <script src="../js/soul-types.js"></script>
  <script src="../js/widget-embed.js"></script>

  <!-- html2canvas for image -->
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <script>
    // i18n translations
    const i18n = {
      ko: {
        widgetGenerator: 'ÏúÑÏ†Ø ÏÉùÏÑ±Í∏∞',
        selectStyle: 'Ïä§ÌÉÄÏùº',
        cardStyle: 'Ïπ¥Îìú',
        badgeStyle: 'Î∞∞ÏßÄ',
        miniStyle: 'ÎØ∏Îãà',
        selectType: 'ÏÜåÏö∏ ÌÉÄÏûÖ',
        preview: 'ÎØ∏Î¶¨Î≥¥Í∏∞',
        copyImage: 'Ïù¥ÎØ∏ÏßÄ Î≥µÏÇ¨',
        download: 'Îã§Ïö¥Î°úÎìú',
        embedCode: 'ÏûÑÎ≤†Îìú',
        share: 'Í≥µÏú†',
        embedCodeTitle: 'ÏûÑÎ≤†Îìú ÏΩîÎìú',
        copyCode: 'ÏΩîÎìú Î≥µÏÇ¨',
        copied: 'Î≥µÏÇ¨Îê®!',
        copyFailed: 'Î≥µÏÇ¨ Ïã§Ìå®'
      },
      en: {
        widgetGenerator: 'Widget Generator',
        selectStyle: 'Style',
        cardStyle: 'Card',
        badgeStyle: 'Badge',
        miniStyle: 'Mini',
        selectType: 'Soul Type',
        preview: 'Preview',
        copyImage: 'Copy Image',
        download: 'Download',
        embedCode: 'Embed',
        share: 'Share',
        embedCodeTitle: 'Embed Code',
        copyCode: 'Copy Code',
        copied: 'Copied!',
        copyFailed: 'Copy failed'
      },
      ja: {
        widgetGenerator: '„Ç¶„Ç£„Ç∏„Çß„ÉÉ„Éà',
        selectStyle: '„Çπ„Çø„Ç§„É´',
        cardStyle: '„Ç´„Éº„Éâ',
        badgeStyle: '„Éê„ÉÉ„Ç∏',
        miniStyle: '„Éü„Éã',
        selectType: '„ÇΩ„Ç¶„É´„Çø„Ç§„Éó',
        preview: '„Éó„É¨„Éì„É•„Éº',
        copyImage: 'ÁîªÂÉè„Ç≥„Éî„Éº',
        download: '„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ',
        embedCode: 'Âüã„ÇÅËæº„Åø',
        share: 'ÂÖ±Êúâ',
        embedCodeTitle: 'Âüã„ÇÅËæº„Åø„Ç≥„Éº„Éâ',
        copyCode: '„Ç≥„Éº„Éâ„Çí„Ç≥„Éî„Éº',
        copied: '„Ç≥„Éî„ÉºÂÆå‰∫Ü!',
        copyFailed: '„Ç≥„Éî„ÉºÂ§±Êïó'
      },
      zh: {
        widgetGenerator: 'Â∞èÈÉ®‰ª∂',
        selectStyle: 'Ê†∑Âºè',
        cardStyle: 'Âç°Áâá',
        badgeStyle: 'ÂæΩÁ´†',
        miniStyle: 'Ëø∑‰Ω†',
        selectType: 'ÁÅµÈ≠ÇÁ±ªÂûã',
        preview: 'È¢ÑËßà',
        copyImage: 'Â§çÂà∂ÂõæÁâá',
        download: '‰∏ãËΩΩ',
        embedCode: 'ÂµåÂÖ•',
        share: 'ÂàÜ‰∫´',
        embedCodeTitle: 'ÂµåÂÖ•‰ª£Á†Å',
        copyCode: 'Â§çÂà∂‰ª£Á†Å',
        copied: 'Â∑≤Â§çÂà∂!',
        copyFailed: 'Â§çÂà∂Â§±Ë¥•'
      },
      es: {
        widgetGenerator: 'Widget',
        selectStyle: 'Estilo',
        cardStyle: 'Tarjeta',
        badgeStyle: 'Insignia',
        miniStyle: 'Mini',
        selectType: 'Tipo de Alma',
        preview: 'Vista Previa',
        copyImage: 'Copiar Imagen',
        download: 'Descargar',
        embedCode: 'Insertar',
        share: 'Compartir',
        embedCodeTitle: 'C√≥digo de Inserci√≥n',
        copyCode: 'Copiar C√≥digo',
        copied: '¬°Copiado!',
        copyFailed: 'Error al copiar'
      }
    };

    let currentLang = 'ko';

    function detectLanguage() {
      const urlParams = new URLSearchParams(window.location.search);
      const langParam = urlParams.get('lang');
      if (langParam && i18n[langParam]) return langParam;

      const saved = localStorage.getItem('ai-life-summary-lang');
      if (saved && i18n[saved]) return saved;

      const browserLang = navigator.language.split('-')[0];
      return i18n[browserLang] ? browserLang : 'ko';
    }

    function t(key) {
      return (i18n[currentLang] && i18n[currentLang][key]) || i18n.en[key] || key;
    }

    function applyTranslations() {
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        el.textContent = t(key);
      });
    }

    // Get widget element
    function getWidgetElement() {
      const previewArea = document.getElementById('preview-area');
      return previewArea.querySelector('.widget-card, .widget-badge, .widget-mini');
    }

    // Copy image to clipboard
    async function copyImageToClipboard() {
      const widget = getWidgetElement();
      if (!widget) return;

      const btn = document.getElementById('btn-copy-image');
      const originalHTML = btn.innerHTML;

      try {
        const canvas = await html2canvas(widget, {
          backgroundColor: null,
          scale: 2
        });

        canvas.toBlob(async (blob) => {
          try {
            await navigator.clipboard.write([
              new ClipboardItem({ 'image/png': blob })
            ]);
            btn.innerHTML = `<span>‚úÖ</span><span>${t('copied')}</span>`;
            btn.classList.add('success');
            setTimeout(() => {
              btn.innerHTML = originalHTML;
              btn.classList.remove('success');
            }, 2000);
          } catch (err) {
            // Fallback: download instead
            downloadImage();
          }
        }, 'image/png');
      } catch (err) {
        console.error('Copy failed:', err);
        alert(t('copyFailed'));
      }
    }

    // Download as PNG
    async function downloadImage() {
      const widget = getWidgetElement();
      if (!widget) return;

      try {
        const canvas = await html2canvas(widget, {
          backgroundColor: null,
          scale: 2
        });

        const link = document.createElement('a');
        link.download = `soul-type-${widgetGenerator.selectedType}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
      } catch (err) {
        console.error('Download failed:', err);
      }
    }

    // Show embed modal
    function showEmbedModal() {
      const dimensions = {
        card: { width: 300, height: 200 },
        badge: { width: 200, height: 60 },
        mini: { width: 100, height: 100 }
      };

      const dim = dimensions[widgetGenerator.selectedStyle];
      const embedUrl = `https://smartaitest.com/widget/embed.html?type=${widgetGenerator.selectedType}&style=${widgetGenerator.selectedStyle}&lang=${currentLang}`;

      const code = `<iframe src="${embedUrl}" width="${dim.width}" height="${dim.height}" frameborder="0" style="border:none;"></iframe>`;

      document.getElementById('embed-code').textContent = code;
      document.getElementById('embed-modal').classList.add('show');
    }

    // Copy embed code
    async function copyEmbedCode() {
      const code = document.getElementById('embed-code').textContent;
      const btn = document.getElementById('btn-copy-code');
      const originalHTML = btn.innerHTML;

      try {
        await navigator.clipboard.writeText(code);
        btn.innerHTML = `<span>‚úÖ</span><span>${t('copied')}</span>`;
        btn.classList.add('success');
        setTimeout(() => {
          btn.innerHTML = originalHTML;
          btn.classList.remove('success');
        }, 2000);
      } catch (err) {
        console.error('Copy failed:', err);
      }
    }

    // Share
    function shareWidget() {
      const shareUrl = `https://smartaitest.com/widget/embed.html?type=${widgetGenerator.selectedType}&style=${widgetGenerator.selectedStyle}&lang=${currentLang}`;
      const shareText = currentLang === 'ko'
        ? `ÎÇòÏùò AI ÏÜåÏö∏ ÌÉÄÏûÖ: ${widgetGenerator.soulTypes?.find(t => t.id === widgetGenerator.selectedType)?.nameKo || ''}`
        : `My AI Soul Type: ${widgetGenerator.soulTypes?.find(t => t.id === widgetGenerator.selectedType)?.nameEn || ''}`;

      if (navigator.share) {
        navigator.share({
          title: 'AI Soul Type',
          text: shareText,
          url: shareUrl
        }).catch(() => {});
      } else {
        // Fallback: copy link
        navigator.clipboard.writeText(shareUrl).then(() => {
          const btn = document.getElementById('btn-share');
          const originalHTML = btn.innerHTML;
          btn.innerHTML = `<span>‚úÖ</span><span>${t('copied')}</span>`;
          setTimeout(() => {
            btn.innerHTML = originalHTML;
          }, 2000);
        });
      }
    }

    // Setup event listeners
    function setupEventListeners() {
      document.getElementById('btn-copy-image').addEventListener('click', copyImageToClipboard);
      document.getElementById('btn-download').addEventListener('click', downloadImage);
      document.getElementById('btn-embed').addEventListener('click', showEmbedModal);
      document.getElementById('btn-share').addEventListener('click', shareWidget);
      document.getElementById('btn-copy-code').addEventListener('click', copyEmbedCode);

      document.getElementById('close-modal').addEventListener('click', () => {
        document.getElementById('embed-modal').classList.remove('show');
      });

      document.getElementById('embed-modal').addEventListener('click', (e) => {
        if (e.target.id === 'embed-modal') {
          document.getElementById('embed-modal').classList.remove('show');
        }
      });
    }

    // Initialize
    function init() {
      currentLang = detectLanguage();
      applyTranslations();
      widgetGenerator.initialize(currentLang);
      setupEventListeners();
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
